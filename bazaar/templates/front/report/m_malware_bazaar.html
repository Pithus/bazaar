{% load get %}

{% if d.malware_bazaar %}
  <h3>MalwareBazaar</h3>
  <table class="table table-condensed table-sm">
    <tr>
      <td class="">First seen</td>
      <td class="">
        {{ d.malware_bazaar.first_seen }}
      </td>
    </tr>
    <tr>
      <td class="">Last seen</td>
      <td class="">
        {{ d.malware_bazaar.last_seen }}
      </td>
    </tr>
    <tr>
      <td class="">Signature</td>
      <td class="">
        {{ d.malware_bazaar.code_sign|default_if_none:"-" }}
      </td>
    </tr>
    <tr>
      <td class="">Report</td>
      <td class="">
        <a class="small" href="https://bazaar.abuse.ch/sample/{{ d.sha256 }}/" target="_blank">
          <i class="fas fa-external-link-alt fa-xs"></i>
          https://bazaar.abuse.ch/sample/{{ d.sha256 }}/
        </a>
      </td>
    </tr>
  </table>
{% endif %}

{% if d.malware_bazaar.vendor_intel.ReversingLabs %}
  <h5>ReversingLabs</h5>
  <table class="table table-condensed table-sm">
    <tr>
      <td class="">Threat name</td>
      <td class=""><span class="badge badge-danger">{{ d.malware_bazaar.vendor_intel.ReversingLabs.threat_name }}</span>
      </td>
    </tr>
    <tr>
      <td class="">Status</td>
      <td class="">{{ d.malware_bazaar.vendor_intel.ReversingLabs.status }}</td>
    </tr>
    <tr>
      <td class="">First seen</td>
      <td class="">{{ d.malware_bazaar.vendor_intel.ReversingLabs.first_seen }}</td>
    </tr>
    <tr>
      <td class="">Score</td>
      <td class="">
        {{ d.malware_bazaar.vendor_intel.ReversingLabs.scanner_match }}/{{ d.malware_bazaar.vendor_intel.ReversingLabs.scanner_count }}
      </td>
    </tr>
  </table>
{% endif %}

{% if d.malware_bazaar.vendor_intel.Triage %}
  <h5>Hatching Triage</h5>
  <table class="table table-condensed table-sm">
    <tr>
      <td class="">Score</td>
      <td class=""><span class="badge badge-danger">{{ d.malware_bazaar.vendor_intel.Triage.score }}/10</span></td>
    </tr>
    <tr>
      <td class="">Tags</td>
      <td class="">
        {% for t in d.malware_bazaar.vendor_intel.Triage.tags %}
          <span class="badge badge-secondary text-white">{{ t }}</span>
        {% endfor %}
      </td>
    </tr>
    <tr>
      <td class="">Report</td>
      <td class="">
        <a class="small" href="{{ d.malware_bazaar.vendor_intel.Triage.link }}" target="_blank">
          <i class="fas fa-external-link-alt fa-xs"></i>
          {{ d.malware_bazaar.vendor_intel.Triage.link }}
        </a>
      </td>
    </tr>
  </table>
{% endif %}

{% with cert_pl=d.malware_bazaar.vendor_intel|get:"CERT-PL_MWDB" %}
  {% if cert_pl %}
    <h5>CERT-PL MWDB</h5>
    <table class="table table-condensed table-sm">
      <tr>
        <td class="">Detection</td>
        <td class=""><span class="badge badge-danger">{{ cert_pl.detection }}</span></td>
      </tr>
      <tr>
        <td class="">Report</td>
        <td class="">
          <a class="small" href="{{ cert_pl.link }}" target="_blank">
            <i class="fas fa-external-link-alt fa-xs"></i>
            {{ cert_pl.link }}
          </a>
          <span class="text-warning small" data-toggle="tooltip" data-placement="top" title="MWDB account required">
            <i class="fas fa-exclamation-triangle"></i>
          </span>
        </td>
      </tr>
    </table>
  {% endif %}
{% endwith %}

{% if d.vt %}
  <h3>VirusTotal</h3>
  <table class="table table-condensed table-sm">
    <tr>
      <td class="">Score</td>
      <td class=""><span class="badge badge-danger">{{ d.vt.malicious }}/{{ d.vt.total }}</span></td>
    </tr>
    <tr>
      <td class="">Report</td>
      <td class="">
        <a class="small" href="https://www.virustotal.com/gui/file/{{ d.sha256 }}/detection" target="_blank">
          <i class="fas fa-external-link-alt fa-xs"></i>
          https://www.virustotal.com/gui/file/{{ d.sha256 }}/detection
        </a>
      </td>
    </tr>
  </table>
{% endif %}
